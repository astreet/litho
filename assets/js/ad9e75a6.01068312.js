"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1785],{7772:(e,n,a)=>{a.d(n,{Z:()=>u});var t=a(83117),o=a(67294),i=a(23746),m=a(7694),l=a(13618),p="0.44.0",r="0.45.0-SNAPSHOT",s="0.10.4",d="0.142.0",c=a(86668);const u=function(e){var n=e.language,a=e.code.replace(/{{site.lithoVersion}}/g,p).replace(/{{site.soloaderVersion}}/g,s).replace(/{{site.lithoSnapshotVersion}}/g,r).replace(/{{site.flipperVersion}}/g,d).trim(),u=(0,c.L)().isDarkTheme?l.Z:m.Z;return o.createElement(i.ZP,(0,t.Z)({},i.lG,{code:a,language:n,theme:u}),(function(e){var n=e.className,a=e.style,t=e.tokens,i=e.getLineProps,m=e.getTokenProps;return o.createElement("pre",{className:n,style:a},t.map((function(e,n){return o.createElement("div",i({line:e,key:n}),e.map((function(e,n){return o.createElement("span",m({token:e,key:n}))})))})))}))}},93422:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>u,contentTitle:()=>d,default:()=>x,frontMatter:()=>s,metadata:()=>c,toc:()=>h});var t=a(83117),o=a(80102),i=(a(67294),a(3905)),m=a(44996),l=a(65488),p=a(85162),r=(a(7772),["components"]),s={id:"dynamic-props",title:"Animating View Properties with Dynamic Props"},d=void 0,c={unversionedId:"animations/dynamic-props",id:"animations/dynamic-props",title:"Animating View Properties with Dynamic Props",description:"Dynamic props are properties that are applied directly to a View or Drawable. They are updated without computing a layout or remounting. This makes them efficient for use in animations or other dynamic UIs. Dynamic props are initialised and updated using DynamicValue.",source:"@site/../docs/animations/dynamic-props.mdx",sourceDirName:"animations",slug:"/animations/dynamic-props",permalink:"/docs/animations/dynamic-props",draft:!1,editUrl:"https://github.com/facebook/litho/edit/master/website/../docs/animations/dynamic-props.mdx",tags:[],version:"current",frontMatter:{id:"dynamic-props",title:"Animating View Properties with Dynamic Props"},sidebar:"mainSidebar",previous:{title:"Customizing Transitions",permalink:"/docs/animations/transition-choreography"},next:{title:"More Ways to Define Transitions",permalink:"/docs/animations/transition-definitions"}},u={},h=[{value:"<code>DynamicValue</code>",id:"dynamicvalue",level:2},{value:"Common Dynamic Props",id:"common-dynamic-props",level:2},{value:"Custom Dynamic Props for MountSpecs",id:"custom-dynamic-props-for-mountspecs",level:2},{value:"Animating Dynamic Props",id:"animating-dynamic-props",level:2}],y={toc:h};function x(e){var n=e.components,a=(0,o.Z)(e,r);return(0,i.mdx)("wrapper",(0,t.Z)({},y,a,{components:n,mdxType:"MDXLayout"}),(0,i.mdx)("admonition",{type:"note"},(0,i.mdx)("p",{parentName:"admonition"},"Dynamic props are properties that are applied directly to a ",(0,i.mdx)("inlineCode",{parentName:"p"},"View")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"Drawable"),". They are updated without computing a layout or remounting. This makes them efficient for use in animations or other dynamic UIs. Dynamic props are initialised and updated using ",(0,i.mdx)("a",{parentName:"p",href:"pathname:///javadoc/com/facebook/litho/DynamicValue.html"},(0,i.mdx)("inlineCode",{parentName:"a"},"DynamicValue")),".")),(0,i.mdx)("h2",{id:"dynamicvalue"},(0,i.mdx)("inlineCode",{parentName:"h2"},"DynamicValue")),(0,i.mdx)("p",null,"To control a dynamic prop, you should create a ",(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue")," and assign it to that prop. You can then keep a reference to the ",(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue")," and use it to directly set values (such as in a callback or an ",(0,i.mdx)("inlineCode",{parentName:"p"},"Animator"),"). Use the ",(0,i.mdx)("inlineCode",{parentName:"p"},"set()")," function to set new values from the main thread. In ",(0,i.mdx)("inlineCode",{parentName:"p"},"KComponents"),", a ",(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue")," can be created using ",(0,i.mdx)("inlineCode",{parentName:"p"},"useBinding()"),"."),(0,i.mdx)("admonition",{type:"caution"},(0,i.mdx)("p",{parentName:"admonition"},(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue"),"s should only be updated on the main thread.")),(0,i.mdx)("h2",{id:"common-dynamic-props"},"Common Dynamic Props"),(0,i.mdx)("p",null,"The dynamic properties that are available for all ",(0,i.mdx)("inlineCode",{parentName:"p"},"Component"),"s are:"),(0,i.mdx)("ul",null,(0,i.mdx)("li",{parentName:"ul"},"Alpha"),(0,i.mdx)("li",{parentName:"ul"},"Scale X/Y"),(0,i.mdx)("li",{parentName:"ul"},"Translation X/Y"),(0,i.mdx)("li",{parentName:"ul"},"Background Color"),(0,i.mdx)("li",{parentName:"ul"},"Foreground Color"),(0,i.mdx)("li",{parentName:"ul"},"Rotation"),(0,i.mdx)("li",{parentName:"ul"},"Elevation (from Lollipop and above)")),(0,i.mdx)("p",null,"To use these, create and pass a ",(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue<T>")," object to the component."),(0,i.mdx)("p",null,"For Spec components these props can be set in the builder:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-kotlin"},"MyComponent.create(c).alpha(dynamicAlpha).build()\n")),(0,i.mdx)("p",null,"For ",(0,i.mdx)("inlineCode",{parentName:"p"},"KComponent"),"s they should be applied as a Style item:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-kotlin"},"MyKComponent(style = Style.alpha(dynamicAlpha))\n")),(0,i.mdx)("p",null,"The ",(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue")," can be updated by calling its ",(0,i.mdx)("a",{parentName:"p",href:"pathname:///javadoc/com/facebook/litho/DynamicValue.html#set-T-"},(0,i.mdx)("inlineCode",{parentName:"a"},"set()"))," function."),(0,i.mdx)("p",null,"The following code sample shows a ",(0,i.mdx)("inlineCode",{parentName:"p"},"Component")," that renders a square in the middle of the screen. The alpha and scale props have been set to the DynamicValue's, which are updated by two SeekBars."),(0,i.mdx)(l.default,{groupId:"state",defaultValue:"kcomponent_state",values:[{label:"KComponent",value:"kcomponent_state"},{label:"Spec",value:"spec_state"}],mdxType:"Tabs"},(0,i.mdx)(p.default,{value:"kcomponent_state",mdxType:"TabItem"},(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-kotlin",metastring:"file=sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/CommonDynamicPropsKComponent.kt  start=start_example end=end_example",file:"sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/CommonDynamicPropsKComponent.kt","":!0,start:"start_example",end:"end_example"},"class CommonDynamicPropsKComponent : KComponent() {\n\n  override fun ComponentScope.render(): Component? {\n    val scale = useBinding(1f)\n    val alpha = useBinding(1f)\n\n    val square =\n        Column(\n            style =\n                Style.width(100.dp)\n                    .height(100.dp)\n                    .backgroundColor(colorRes(R.color.primaryColor))\n                    .alignSelf(YogaAlign.CENTER)\n                    .scaleX(scale)\n                    .scaleY(scale)\n                    .alpha(alpha))\n\n    return Column(justifyContent = YogaJustify.SPACE_BETWEEN, style = Style.padding(all = 20.dp)) {\n      child(SeekBar(onProgressChanged = { alpha.set(it) }))\n      child(square)\n      child(SeekBar(onProgressChanged = { scale.set(it) }))\n    }\n  }\n}\n"))),(0,i.mdx)(p.default,{value:"spec_state",mdxType:"TabItem"},(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-kotlin",metastring:"file=sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/CommonDynamicPropsComponentSpec.kt  start=start_example end=end_example",file:"sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/CommonDynamicPropsComponentSpec.kt","":!0,start:"start_example",end:"end_example"},"@LayoutSpec\nobject CommonDynamicPropsComponentSpec {\n\n  @OnCreateInitialState\n  fun onCreateInitialState(\n      c: ComponentContext,\n      alpha: StateValue<DynamicValue<Float>>,\n      scale: StateValue<DynamicValue<Float>>,\n  ) {\n    alpha.set(DynamicValue<Float>(1f))\n    scale.set(DynamicValue<Float>(1f))\n  }\n\n  @OnCreateLayout\n  fun onCreateLayout(\n      c: ComponentContext,\n      @State alpha: DynamicValue<Float>,\n      @State scale: DynamicValue<Float>,\n  ): Component {\n    val square =\n        Column.create(c)\n            .widthDip(100f)\n            .heightDip(100f)\n            .backgroundRes(R.color.primaryColor)\n            .alignSelf(YogaAlign.CENTER)\n            .scaleX(scale)\n            .scaleY(scale)\n            .alpha(alpha)\n            .build()\n\n    return Column.create(c)\n        .justifyContent(YogaJustify.SPACE_BETWEEN)\n        .paddingDip(YogaEdge.ALL, 20f)\n        .child(\n            SeekBar.create(c).heightDip(14f).widthPercent(100f).initialValue(1f).onProgressChanged {\n              alpha.set(it)\n            })\n        .child(square)\n        .child(\n            SeekBar.create(c).heightDip(14f).widthPercent(100f).initialValue(1f).onProgressChanged {\n              scale.set(it)\n            })\n        .build()\n  }\n}\n")))),(0,i.mdx)("p",null,"The following short animation illustrates the component in action."),(0,i.mdx)("video",{loop:"true",autoplay:"true",class:"video",width:"100%",height:"500px",muted:"true"},(0,i.mdx)("source",{type:"video/webm",src:(0,m.default)("/videos/common_dynamic_props.webm")}),(0,i.mdx)("p",null,"Your browser does not support the video element.")),(0,i.mdx)("p",null,"To see how other common dynamic props can be modified, see the ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/litho/tree/master/sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/AllCommonDynamicPropsKComponent.kt"},"All Common Dynamic Props")," example in the Sample app, which is illustrated in the following animation."),(0,i.mdx)("video",{loop:"true",autoplay:"true",class:"video",width:"100%",height:"500px",muted:"true"},(0,i.mdx)("source",{type:"video/webm",src:(0,m.default)("/videos/all_dynamic_props.webm")}),(0,i.mdx)("p",null,"Your browser does not support the video element.")),(0,i.mdx)("h2",{id:"custom-dynamic-props-for-mountspecs"},"Custom Dynamic Props for MountSpecs"),(0,i.mdx)("admonition",{type:"note"},(0,i.mdx)("p",{parentName:"admonition"},(0,i.mdx)("inlineCode",{parentName:"p"},"MountSpec"),"s are only available in the Spec API.  There is currently no equivalent in the KComponent API.")),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"MountSpec"),"s can define custom dynamic props. Props annotated with ",(0,i.mdx)("inlineCode",{parentName:"p"},"@Prop(dynamic = true)")," can be set to a ",(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue"),". Setting this value will trigger a custom ",(0,i.mdx)("inlineCode",{parentName:"p"},"@OnBindDynamicValue")," function in the component."),(0,i.mdx)("p",null,"Consider a ",(0,i.mdx)("inlineCode",{parentName:"p"},"MountSpec")," that renders a clock face:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-kotlin",metastring:"file=sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/ClockFaceSpec.kt  start=start_example end=end_example",file:"sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/ClockFaceSpec.kt","":!0,start:"start_example",end:"end_example"},"@MountSpec\nobject ClockFaceSpec {\n\n  @OnCreateMountContent\n  fun onCreateMountContent(androidContext: Context): SimpleClockView {\n    return SimpleClockView(androidContext)\n  }\n\n  @OnBindDynamicValue\n  fun onBindTime(simpleClockView: SimpleClockView, @Prop(dynamic = true) time: Long) {\n    simpleClockView.time = time\n  }\n}\n")),(0,i.mdx)("p",null,"Here, the ",(0,i.mdx)("inlineCode",{parentName:"p"},"MountSpec")," delegates the drawing of a clock face to ",(0,i.mdx)("inlineCode",{parentName:"p"},"SimpleClockView"),". Marking the ",(0,i.mdx)("inlineCode",{parentName:"p"},"time")," prop with ",(0,i.mdx)("inlineCode",{parentName:"p"},"@Prop(dynamic = true)")," will cause an additional method to be generated in the builder that accepts a ",(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue"),". The method to set a static value will also remain available. When ",(0,i.mdx)("inlineCode",{parentName:"p"},"set()")," is called on the ",(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue"),", the ",(0,i.mdx)("inlineCode",{parentName:"p"},"@OnBindDynamicValue")," function will be executed. In this example, the new time is passed to the ",(0,i.mdx)("inlineCode",{parentName:"p"},"ClockView")," to draw the updated clock face."),(0,i.mdx)("p",null,"Next, consider a slider to set the time on the clock face."),(0,i.mdx)(l.default,{groupId:"state",defaultValue:"kcomponent_state",values:[{label:"KComponent",value:"kcomponent_state"},{label:"Spec",value:"spec_state"}],mdxType:"Tabs"},(0,i.mdx)(p.default,{value:"kcomponent_state",mdxType:"TabItem"},(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-kotlin",metastring:"file=sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/CustomDynamicPropsKComponent.kt  start=start_example end=end_example",file:"sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/CustomDynamicPropsKComponent.kt","":!0,start:"start_example",end:"end_example"},"class CustomDynamicPropsKComponent : KComponent() {\n\n  override fun ComponentScope.render(): Component? {\n    val time = useBinding(0L)\n\n    return Column(style = Style.padding(all = 20.dp)) {\n      child(SeekBar { time.set((it * TimeUnit.HOURS.toMillis(12)).toLong()) })\n      child(\n          ClockFaceMountable(\n              time = time,\n              style =\n                  Style.width(200.dp)\n                      .height(200.dp)\n                      .margin(top = 20.dp)\n                      .alignSelf(YogaAlign.CENTER)))\n    }\n  }\n}\n"))),(0,i.mdx)(p.default,{value:"spec_state",mdxType:"TabItem"},(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-kotlin",metastring:"file=sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/CustomDynamicPropsComponentSpec.kt  start=start_example end=end_example",file:"sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/CustomDynamicPropsComponentSpec.kt","":!0,start:"start_example",end:"end_example"},"@LayoutSpec\nobject CustomDynamicPropsComponentSpec {\n\n  @OnCreateInitialState\n  fun onCreateInitialState(c: ComponentContext, time: StateValue<DynamicValue<Long>>) {\n    time.set(DynamicValue<Long>(0))\n  }\n\n  @OnCreateLayout\n  fun onCreateLayout(c: ComponentContext, @State time: DynamicValue<Long>): Component =\n      Column.create(c)\n          .alignItems(YogaAlign.CENTER)\n          .paddingDip(YogaEdge.ALL, 20f)\n          .child(\n              SeekBar.create(c)\n                  .heightDip(14f)\n                  .widthPercent(100f)\n                  .initialValue(1f)\n                  .onProgressChanged { time.set((it * TimeUnit.HOURS.toMillis(12)).toLong()) })\n          .child(\n              ClockFace.create(c)\n                  .time(time)\n                  .widthDip(200f)\n                  .heightDip(200f)\n                  .marginDip(YogaEdge.TOP, 20f)\n                  .build())\n          .build()\n}\n")))),(0,i.mdx)("p",null,"This is illustrated in the following short animation."),(0,i.mdx)("video",{loop:"true",autoplay:"true",class:"video",width:"100%",height:"500px",muted:"true"},(0,i.mdx)("source",{type:"video/webm",src:(0,m.default)("/videos/custom_prop_slider.webm")}),(0,i.mdx)("p",null,"Your browser does not support the video element.")),(0,i.mdx)("h2",{id:"animating-dynamic-props"},"Animating Dynamic Props"),(0,i.mdx)("p",null,"Dynamic Props values can be used with Android Animators to create custom animations. The following example uses a ",(0,i.mdx)("a",{parentName:"p",href:"https://developer.android.com/reference/android/animation/ValueAnimator"},"ValueAnimator")," to animate the dynamic value ",(0,i.mdx)("inlineCode",{parentName:"p"},"time"),", defined in the previous value."),(0,i.mdx)(l.default,{groupId:"state",defaultValue:"kcomponent_state",values:[{label:"KComponent",value:"kcomponent_state"},{label:"Spec",value:"spec_state"}],mdxType:"Tabs"},(0,i.mdx)(p.default,{value:"kcomponent_state",mdxType:"TabItem"},(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-kotlin",metastring:"file=sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/AnimateDynamicPropsKComponent.kt  start=start_example end=end_example",file:"sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/AnimateDynamicPropsKComponent.kt","":!0,start:"start_example",end:"end_example"},'class AnimateDynamicPropsKComponent : KComponent() {\n\n  override fun ComponentScope.render(): Component {\n    val time = useBinding(0L)\n    val animator = useRef<ValueAnimator?> { null }\n\n    val startAnimator: (ClickEvent) -> Unit = {\n      animator.value?.cancel()\n      animator.value =\n          ValueAnimator.ofInt(0, TimeUnit.HOURS.toMillis(12).toInt()).apply {\n            duration = 2000\n            interpolator = AccelerateDecelerateInterpolator()\n            addUpdateListener { time.set((it.animatedValue as Int).toLong()) }\n          }\n      animator.value?.start()\n    }\n\n    return Column(alignItems = YogaAlign.CENTER, style = Style.padding(all = 20.dp)) {\n      child(Text("Click to Start Animation", style = Style.onClick(action = startAnimator)))\n      child(\n          ClockFace.create(context)\n              .time(time)\n              .widthDip(200f)\n              .heightDip(200f)\n              .marginDip(YogaEdge.TOP, 20f)\n              .build())\n    }\n  }\n}\n'))),(0,i.mdx)(p.default,{value:"spec_state",mdxType:"TabItem"},(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-kotlin",metastring:"file=sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/AnimateDynamicPropsComponentSpec.kt  start=start_example end=end_example",file:"sample/src/main/java/com/facebook/samples/litho/kotlin/animations/dynamicprops/AnimateDynamicPropsComponentSpec.kt","":!0,start:"start_example",end:"end_example"},'@LayoutSpec\nobject AnimateDynamicPropsComponentSpec {\n\n  @OnCreateInitialState\n  fun onCreateInitialState(\n      c: ComponentContext,\n      time: StateValue<DynamicValue<Long>>,\n      animator: StateValue<AtomicReference<ValueAnimator?>>,\n  ) {\n    time.set(DynamicValue<Long>(0))\n    animator.set(AtomicReference<ValueAnimator?>(null))\n  }\n\n  @OnCreateLayout\n  fun onCreateLayout(\n      c: ComponentContext,\n      @State time: DynamicValue<Long>,\n      @State animator: AtomicReference<ValueAnimator?>,\n  ): Component? {\n    val startAnimator: (ClickEvent) -> Unit = {\n      animator.get()?.let { it.cancel() }\n      animator.set(\n          ValueAnimator.ofInt(0, TimeUnit.HOURS.toMillis(12).toInt()).apply {\n            duration = 2000\n            interpolator = AccelerateDecelerateInterpolator()\n            addUpdateListener { time.set((it.animatedValue as Int).toLong()) }\n          })\n      animator.get()?.start()\n    }\n\n    return Column.create(c)\n        .paddingDip(YogaEdge.ALL, 20f)\n        .alignItems(YogaAlign.CENTER)\n        .child(\n            Text.create(c)\n                .text("Click to Start Animation")\n                .clickHandler(eventHandler(startAnimator)))\n        .child(\n            ClockFace.create(c)\n                .time(time)\n                .widthDip(200f)\n                .heightDip(200f)\n                .marginDip(YogaEdge.TOP, 20f)\n                .build())\n        .build()\n  }\n}\n')))),(0,i.mdx)("p",null,"A ",(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue")," is used to represent time.  This is passed to the ",(0,i.mdx)("inlineCode",{parentName:"p"},"Component")," as a prop and kept as a reference to it so it can be updated. In a click event, a ValueAnimator is set up that updates the time ",(0,i.mdx)("inlineCode",{parentName:"p"},"DynamicValue")," each frame (see the following animation). The ",(0,i.mdx)("a",{parentName:"p",href:"https://developer.android.com/reference/android/animation/ValueAnimator"},"ValueAnimator")," is stored in a reference so that it can be cancelled if necessary."),(0,i.mdx)("video",{loop:"true",autoplay:"true",class:"video",width:"100%",height:"500px",muted:"true"},(0,i.mdx)("source",{type:"video/webm",src:(0,m.default)("/videos/custom_prop_animation.webm")}),(0,i.mdx)("p",null,"Your browser does not support the video element.")),(0,i.mdx)("p",null,"For more examples of creating Animations using Common Dynamic Props, see the ",(0,i.mdx)("a",{parentName:"p",href:"https://github.com/facebook/litho/tree/master/sample/src/main/java/com/facebook/samples/litho/java/animations/animationcookbook"},"Animations Cook Book")," in the Sample App."))}x.isMDXComponent=!0}}]);